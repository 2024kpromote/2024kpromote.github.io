(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{108:function(e,t){},110:function(e,t){},163:function(e,t,n){},164:function(e,t,n){},165:function(e,t,n){},166:function(e,t,n){},167:function(e,t,n){},168:function(e,t,n){"use strict";n.r(t);var a,r=n(0),c=n.n(r),o=n(79),i=n.n(o),l=(n(86),n(3)),u=n.n(l),s=n(8),f=n(25),m=n(16),d=n(2),p=n(38),v=n.n(p),h=n(17),b=n.n(h),g=n(80),y=n.n(g),O=(n(163),n(6)),E=n(26),j=n(27),w=n(29),k=n(28),S=n(30),x=["blue","red","green","purple"],C=(n(78),n(164),function(e){function t(){return Object(E.a)(this,t),Object(w.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this.props,t=e.data,n=e.fore;return c.a.createElement("div",{className:"char playing ".concat(t.continuing?"continuing":"")},n?c.a.createElement("div",{className:"fgwrap",style:{color:x[t.vocal],position:"relative",width:"0px"}},c.a.createElement("div",{className:"fg fgfg",style:{position:"unset"},dangerouslySetInnerHTML:{__html:t.ch}}),c.a.createElement("div",{className:"fg",dangerouslySetInnerHTML:{__html:t.ch}})):c.a.createElement(c.a.Fragment,null,c.a.createElement("div",{className:"bg bgbg",dangerouslySetInnerHTML:{__html:t.ch}}),c.a.createElement("div",{className:"bg",dangerouslySetInnerHTML:{__html:t.ch}})))}}]),t}(r.PureComponent)),N=[{ch:"\u3000"}],T=function(e){var t=e.lines,n=e.player,o=e.isPlaying,i=Object(r.useRef)(null);Object(r.useEffect)(function(){var e=function(){i&&document.fullscreenElement&&document.exitFullscreen()};return document.addEventListener("fullscreenchange",e,!1),document.addEventListener("webkitfullscreenchange",e,!1),document.addEventListener("mozfullscreenchange",e,!1),function(){document.removeEventListener("fullscreenchange",e),document.removeEventListener("webkitfullscreenchange",e),document.removeEventListener("mozfullscreenchange",e)}},[]);var l=Object(r.useState)(),u=Object(d.a)(l,2),s=u[0],f=u[1],m=Object(r.useState)(),p=Object(d.a)(m,2),v=p[0],h=p[1];return Object(r.useEffect)(function(){return clearTimeout(a),function e(){if(o){var r=n.getCurrentTime(),c=t.map(function(e,t){var n=e.findIndex(function(e){return e[0].time-3<=r&&r<e[e.length-1].time}),a=n>-1?n:e.findIndex(function(e){return e[e.length-1].time<=r&&r<e[e.length-1].time+2}),c=!1,o=a>-1?e[a]:N;if(o){var l=o.reduce(function(e,t,n,a){return c&&(t.continuing=!0),c=!t.ch.endsWith("&nbsp;"),r<t.time?e:n+1<a.length&&r<a[n+1].time?e+(r-t.time)/(a[n+1].time-t.time):e+1},0),u=i.current.querySelectorAll(".foreground")[t];if(u){u.style.width="100%";for(var s=Object(O.a)(u.querySelectorAll(".char .fgwrap")),f=0;f<s.length;)s[f].style.width=f+1<=l?"100%":"".concat(100*Math.max(0,l-f),"%"),f++}return o}return null}).filter(function(e){return!!e}),l=Object(d.a)(c,2),u=l[0],s=l[1];f(u),h(s),a=setTimeout(e,20)}}(),function(){clearTimeout(a)}},[n,o,t]),c.a.createElement("div",{id:"playing-lyrics",ref:i},[s,v].map(function(e,t){return e&&c.a.createElement("div",{key:t,style:{float:0===t?"unset":"right"}},c.a.createElement("div",{key:t,style:{position:"relative",display:"inline-block"}},c.a.createElement("div",{style:{position:"absolute",overflow:"visible",whiteSpace:"nowrap",width:"100%",filter:"blur(1em)",background:"#000",padding:"0.05em"}},"\u3000"),c.a.createElement("div",{style:{overflow:"visible",whiteSpace:"nowrap"}},e.map(function(e,t){return c.a.createElement(C,{key:t,data:e})})),c.a.createElement("div",{className:"foreground",style:{position:"absolute",left:"0px",top:"0px",overflow:"hidden",whiteSpace:"nowrap"}},e.map(function(e,t){return c.a.createElement(C,{key:t,data:e,fore:!0})}))),c.a.createElement("div",null))}))},L=new Promise(function(e){!function t(){window.YT.Player?e(window.YT.Player):setTimeout(t,100)}()}),A=function(){var e=Object(s.a)(u.a.mark(function e(t,n,a,r,c){var o;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L;case 2:o=e.sent,n&&(n.stopVideo(),n.destroy(),a(null)),new o("player",{videoId:t,playerVars:Object(m.a)({fs:0,playsinline:1},c),events:{onReady:function(e){a(e.target)},onStateChange:function(e){var t=1===e.data||3===e.data;r(t)}}});case 5:case"end":return e.stop()}},e)}));return function(t,n,a,r,c){return e.apply(this,arguments)}}(),P=function(e){var t=e.children,n=Object(r.useRef)();return Object(r.useEffect)(function(){t&&y.a.toCanvas(n.current,"".concat(window.location.origin).concat(t),function(e){e&&console.error(e)})},[t]),c.a.createElement("canvas",{ref:n})},R=function(){var e=Object(r.useState)(void 0),t=Object(d.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(!1),i=Object(d.a)(o,2),l=i[0],p=i[1],h=Object(r.useState)([]),g=Object(d.a)(h,2),y=g[0],O=g[1],E=Object(r.useState)([]),j=Object(d.a)(E,2),w=j[0],k=j[1],S=Object(r.useRef)();return S.current=n,Object(r.useEffect)(function(){var e=window.location.search.substring(1).split("&").reduce(function(e,t){var n=t.split("="),a=Object(d.a)(n,2),r=a[0],c=a[1];return Object(m.a)({},e,Object(f.a)({},r,c))},{}).v,t=function(){var e=Object(s.a)(u.a.mark(function e(){var t,n;return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,v.a.get("/ss/index");case 3:t=e.sent,n=t.data,k(Object.keys(n).map(function(e){return[n[e],e]}).sort(function(e,t){return e[0].localeCompare(t[0])})),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),console.error(e.t0);case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(){return e.apply(this,arguments)}}();e?function(){var n=Object(s.a)(u.a.mark(function n(){var r,c;return u.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,v.a.get("/ss/".concat(e,".kkl"),{responseType:"blob"});case 3:r=n.sent,c=r.data,b.a.loadAsync(c).then(function(){var t=Object(s.a)(u.a.mark(function t(n){var r,c;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=JSON,t.next=3,n.file("content").async("text");case 3:return t.t1=t.sent,r=t.t0.parse.call(t.t0,t.t1),(c=r.data).forEach(function(e){e.forEach(function(e){e.forEach(function(e){e.ch=e.ch.replace(/ /g,"&nbsp;")})})}),O(c),t.next=10,A(e,S.current,a,p,{autoplay:!0});case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}(),function(e){console.error(e),t()}),n.next=12;break;case 8:n.prev=8,n.t0=n.catch(0),console.error(n.t0),t();case 12:case"end":return n.stop()}},n,null,[[0,8]])}));return function(){return n.apply(this,arguments)}}()():t()},[]),c.a.createElement("div",{className:"Player"},c.a.createElement("div",{id:"player-container"},c.a.createElement("div",{className:"links"},(!n||!l)&&c.a.createElement("a",{href:"".concat(window.location.origin)},c.a.createElement("div",{style:{margin:10}},"\u9996\u9801"),c.a.createElement(P,null,"/")),!n&&w.map(function(e){var t=Object(d.a)(e,2),n=t[0],a=t[1];return c.a.createElement("a",{key:a,href:"".concat(window.location.origin,"/?v=").concat(a)},c.a.createElement("div",{style:{margin:10}},n),c.a.createElement(P,null,"/?v=".concat(a)))})),c.a.createElement("div",{id:"player"}),!!n&&c.a.createElement(T,{lines:y,player:n,isPlaying:l})))},I=n(39),M=(n(165),n(166),function(e){function t(){return Object(E.a)(this,t),Object(w.a)(this,Object(k.a)(t).apply(this,arguments))}return Object(S.a)(t,e),Object(j.a)(t,[{key:"render",value:function(){var e=this.props,t=e.focused,n=e.currentVocal,a=e.onSetCursor,o=e.data,i=e.nextData,l=e.index;return c.a.createElement(r.Fragment,{key:l},c.a.createElement("div",{className:"char ".concat(t?"selected":""),style:{borderLeftColor:t?x[n]:"transparent"},onClick:a&&a(l)},c.a.createElement("div",{className:"bg bgbg"},o.ch),c.a.createElement("div",{className:"bg"},o.ch),c.a.createElement("div",{className:"fgwrap",style:{width:o.time?i&&i.time?"100%":"50%":"0px",color:x[o.vocal]}},c.a.createElement("div",{className:"fg fgfg"},o.ch),c.a.createElement("div",{className:"fg"},o.ch))),"\n"===o.ch&&c.a.createElement("div",null))}}]),t}(r.PureComponent)),_=function(e){e.source,e.onChange;var t=e.player,n=e.isPlaying,a=e.model,o=e.updateModel,i=Object(r.useRef)(null),l=Object(r.useRef)(null),u=Object(r.useState)(""),s=Object(d.a)(u,2),f=s[0],m=s[1],p=Object(r.useState)([]),v=Object(d.a)(p,2),h=v[0],b=v[1];Object(r.useEffect)(function(){a&&(m(a.text||""),b(a.chars||[]))},[a]);var g=Object(r.useState)(0),y=Object(d.a)(g,2),E=y[0],j=y[1],w=Object(r.useState)(0),k=Object(d.a)(w,2),S=k[0],C=k[1],N=function(e){if(27!==e.keyCode){if(n){var a=e.keyCode-65;x[a]&&j(a);var r=S,c=t.getCurrentTime();if(37===e.keyCode)t.seekTo(c-3);else if(39===e.keyCode)t.seekTo(c+3);else if(8===e.keyCode){if(r>0){for(var o=Object(O.a)(h);r>0&&(o[r].time=void 0,o[r].vocal=void 0,C(r-=1),o[r].time=void 0,o[r].vocal=void 0,"\n"===o[r].ch)&&!(r>0&&"\n"!==o[r-1].ch););b(o)}else if(h[r].time){var i=Object(O.a)(h);i[r].time=void 0,b(i)}}else if(13===e.keyCode&&r<h.length){for(var l=Object(O.a)(h);r<h.length&&(l[r].time=c,l[r].vocal=E,C(r+1),"\n"===l[r].ch)&&!(r+1<h.length&&"\n"!==l[r+1].ch);)r+=1;b(l)}}}else t&&(n?t.pauseVideo():t.playVideo())},T=Object(r.useRef)();T.current=f;var L=Object(r.useRef)();L.current=h,Object(r.useEffect)(function(){i.current&&i.current.focus(),l.current&&l.current.focus(),n||o(T.current,L.current)},[n,o]);var A,P=function(e){return function(){C(e);for(var t=e,n=Object(O.a)(h);t<h.length&&(n[t].time=void 0,n[t].vocal=void 0,!("\n"===n[t].ch&&t+1<h.length&&"\n"!==n[t+1].ch));)t+=1;b(n)}};return c.a.createElement("div",{className:"lyrics-editor"},c.a.createElement("div",null),c.a.createElement("div",{ref:i,className:"lyrics",tabIndex:"1",onKeyDown:N,style:{display:n?"block":"none"}},h.map(function(e,t){return c.a.createElement(M,{key:t,focused:S===t,currentVocal:E,onSetCursor:P,data:e,nextData:h[t+1],index:t})})),c.a.createElement("button",{className:"player-source",onClick:function(){if(!(h.length<=0)){for(var e=t.getCurrentTime(),n=Object(O.a)(h),a=e-h[0].time,r=0;r<h.length;)n[r].time+=a,r+=1;b(n)}}},"Anchor [",h.length&&(A=h[0].time,"".concat((A-A%3600)/3600,":").concat((A-A%60)/60,":").concat(Math.floor(A))),"]"),c.a.createElement("textarea",{ref:l,onChange:function(e){var t=e.target,n=t.selectionStart,a=t.selectionEnd,r=t.value.replace(/\r+/g,"").replace(/^\s+/g,"").replace(/\s+$/g,"");e.target.value=r,e.target.setSelectionRange(n,a),m(r);var c=r.match(/(\{W\}([\s\S](?!{[WC]}))*([\s\S](?={[WC]}))?)|(\{C\})|([\s\S])/g);if(c.push("\n"),c){for(var o=0,i=0,l=0,u=c.reduce(function(e,t){return 0===t.indexOf("{W}")?t.substring(3).match(/(\n|[^-\s]+[^-\n]?)/g).forEach(function(t){e.push(t)}):0===t.indexOf("{C}")||e.push(t),e},[]).reduce(function(e,t,n,a){return"\n"===t?(0===i&&(l=-1),e.push({row:o,col:i,line:l,ch:t}),o+=1,i=0,l+=1):(e.push({row:o,col:i,line:l,ch:t}),i+=1),e},[]),s=0;s<h.length&&s<u.length&&h[s].row===u[s].row&&h[s].col===u[s].col&&h[s].line===u[s].line&&h[s].ch===u[s].ch;)u[s]=h[s],s+=1;b(u)}else b([])},onKeyDown:N,readOnly:n,value:f,style:{display:n?"none":"block"}}))},D=function(e){var t=e.onSelect,n=e.accept,a=Object(r.useRef)(null);return c.a.createElement(c.a.Fragment,null,c.a.createElement("input",{ref:a,style:{display:"none"},type:"file",accept:n,onChange:function(e){t(e),e.target.value=""}}),c.a.createElement("button",{className:"player-source",onClick:function(){a.current.click()}},"Open"))},W=function(){var e=Object(r.useState)(),t=Object(d.a)(e,2),n=t[0],a=t[1],o=Object(r.useState)(),i=Object(d.a)(o,2),l=i[0],f=i[1],p=Object(r.useState)({}),v=Object(d.a)(p,2),h=v[0],g=v[1],y=Object(r.useState)(void 0),E=Object(d.a)(y,2),j=E[0],w=E[1],k=Object(r.useState)(!1),S=Object(d.a)(k,2),x=S[0],C=S[1],N=Object(r.useState)([]),L=Object(d.a)(N,2),P=L[0],R=L[1],M=Object(r.useRef)();M.current=j;var W=function(e){var t=Object(O.a)(e).sort(function(e,t){return void 0===e.time?1:void 0===t.time?-1:e.time-t.time}).reduce(function(e,t){if(t.line<0)return e;for(;!e[t.line];)e.push([]);return e[t.line].length||e[t.line].push([]),e[t.line][e[t.line].length-1].push(Object(m.a)({},t,{ch:t.ch.replace(/ /g,"&nbsp;")})),"\n"===t.ch&&e[t.line].length&&e[t.line].push([]),e},[]).map(function(e){return e.filter(function(e){return e.length})});R(t)};Object(r.useEffect)(function(){n&&function(){var e=Object(s.a)(u.a.mark(function e(){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A(n,M.current,w,C);case 2:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()()},[n]);var F=function(e){a(e.id),f(e.name),g(e),W(e.chars)},J=Object(r.useCallback)(function(e,t){W(t),g({id:h.id,name:l,text:e,chars:t})},[h.id,l]);return c.a.createElement("div",{className:"Editor"},c.a.createElement("div",{id:"player-container"},c.a.createElement("div",{className:"form"},c.a.createElement("div",{className:"input"},c.a.createElement("input",{className:"player-source",type:"text",placeholder:"Source ID",onChange:function(e){a(e.target.value.trim())},value:n}),c.a.createElement("input",{className:"player-source",type:"text",placeholder:"Source name",onChange:function(e){f(e.target.value.trim())},value:l}),c.a.createElement("button",{className:"player-source",onClick:function(){F({id:n,name:l,text:"",chars:[]})},disabled:!n||!l},"Create")),c.a.createElement(D,{onSelect:function(e){var t=e.target&&e.target.files[0];if(t)try{b.a.loadAsync(t).then(function(){var e=Object(s.a)(u.a.mark(function e(t){return u.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=F,e.t1=JSON,e.next=4,t.file("content").async("text");case 4:e.t2=e.sent,e.t3=e.t1.parse.call(e.t1,e.t2),(0,e.t0)(e.t3);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),function(e){console.error(e)})}catch(e){console.error(e)}},accept:".kkt"}),c.a.createElement("button",{className:"player-source",onClick:function(){var e=prompt("Save","".concat(h.id,"-").concat(h.name,".kkt"));if(e){var t=new b.a;t.file("content",JSON.stringify(h)),t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}).then(function(t){Object(I.saveAs)(t,e)},function(e){console.error(e)})}},disabled:!h||!h.id},"Save")),c.a.createElement("div",{id:"player"}),j&&c.a.createElement(T,{lines:P,player:j,isPlaying:x})),c.a.createElement(_,{player:j,isPlaying:x,model:h,updateModel:J}),c.a.createElement("button",{className:"player-source",onClick:function(){var e=prompt("Save","".concat(h.id,".kkl"));if(e){var t=new b.a;t.file("content",JSON.stringify({id:n,name:l,data:P.map(function(e){return e.map(function(e){return e.map(function(e){return{time:e.time,ch:e.ch,vocal:e.vocal}})})})})),t.generateAsync({type:"blob",compression:"DEFLATE",compressionOptions:{level:9}}).then(function(t){Object(I.saveAs)(t,e)},function(e){console.error(e)})}}},"Publish"))},F=(n(167),function(){var e="/editor"===window.location.pathname||"/editor/"===window.location.pathname;return c.a.createElement("div",{className:"App"},e?c.a.createElement(W,null):c.a.createElement(R,null))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(F,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},78:function(e,t,n){},81:function(e,t,n){e.exports=n(168)},86:function(e,t,n){}},[[81,1,2]]]);